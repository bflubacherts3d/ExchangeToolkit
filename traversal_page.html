<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Exchange Toolkit: Product Traversal</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="ExchangeToolkit.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Exchange Toolkit
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Product Traversal </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#traversal_problem_statement">The Challenge</a></li>
<li class="level1"><a href="#instance_path">Concept: Instance Path</a></li>
<li class="level1"><a href="#leaf_node">Concept: Leaf Node</a></li>
<li class="level1"><a href="#traversal_functions">Traversal Solution</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="traversal_problem_statement"></a>
The Challenge</h1>
<p>The Exchange data model is complex. It captures details about a model file such as <a href="https://docs.techsoft3d.com/exchange/latest/build/product_occurrence.html">assembly organization</a>, <a href="https://docs.techsoft3d.com/exchange/latest/build/managing_attribute_inheritance.html">attribute inheritance</a>, <a href="https://docs.techsoft3d.com/exchange/latest/build/markup2.html">PMI</a>, <a href="https://docs.techsoft3d.com/exchange/latest/build/reading_geometry.html">geometry and tessellation</a>. As a result, the code required to traverse the data model can be burdensome. Figure 1 illustrates a portion of this complexity as a UML diagram with recursive containers.</p>
<div class="image">
<img src="ExchangeDataModel.png" alt="ExchangeDataModel.png"/>
<div class="caption">
Figure 1. UML diagram of a portion of the Exchange data model</div></div>
<p> A direct approach for navigating the data structures to get to an object containing the information of interest typically involves writing one function per object type, with each implementation iterating over a child container and calling appropriate functions to traverse deeper into the hierarchy. This has the downside of complexity and function implementations that are just slight variations from one another, giving the feeling of code duplication. Another possible implementation is to employ the <a href="https://en.wikipedia.org/wiki/Visitor_pattern">Visitor Design Pattern</a>. This approach has a tendency of being overly complex and requires object inheritance, virtual function calls and a bloated interface if it is to cover the entirety of the Exchange data model.</p>
<p>The Exchange Toolkit solves this problem in a much simpler way.</p>
<h1><a class="anchor" id="instance_path"></a>
Concept: Instance Path</h1>
<p>The Exchange Toolkit addresses this challenge by first introducing the concept of an <a class="el" href="group__access.html#gae4230d9b05a294acfdc44503d148f3ce" title="Used to abstract an ordered collection of Exchange objects. ">ts3d::EntityArray</a>. This is nothing more than a <code>typedef</code> of a standard ordered container of <code>A3DEntity*</code>. An ordered container of generic "base class" pointers allows us to represent a particular path through the model's hierarchy. In the context of a path through the hierarchy, the alias <a class="el" href="group__traversal.html#ga2550c35e83a8d01e9a0155a084a5166d" title="The InstancePath type is used to identify a particular path through the hierarchy of Exchange objects...">ts3d::InstancePath</a> is used.</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span><a class="code" href="namespacets3d.html">ts3d</a> {</div><div class="line">    <span class="keyword">using</span> <a class="code" href="group__access.html#gae4230d9b05a294acfdc44503d148f3ce">EntityArray</a> = std::vector&lt;A3DEntity*&gt;;</div><div class="line">    <span class="keyword">using</span> <a class="code" href="group__access.html#gae64faaef9322c388f862a125363d4ca0">EntitySet</a> = std::set&lt;A3DEntity*&gt;;</div><div class="line">    <span class="keyword">using</span> <a class="code" href="group__traversal.html#ga2550c35e83a8d01e9a0155a084a5166d">InstancePath</a> = <a class="code" href="group__access.html#gae4230d9b05a294acfdc44503d148f3ce">EntityArray</a>;</div><div class="line">    <span class="keyword">using</span> <a class="code" href="group__traversal.html#ga6c2fc4ed635f4edf48fd9e75bdb06263">InstancePathArray</a> = std::vector&lt;InstancePath&gt;;</div><div class="line">}</div></div><!-- fragment --><p><a class="el" href="instance_path_details.html">Why is an InstancePath useful?</a></p>
<h1><a class="anchor" id="leaf_node"></a>
Concept: Leaf Node</h1>
<p>Throughought the Exchange Toolkit, you may encounter the term "leaf node". This simply refers to the <em>last</em> object in an instance path.</p>
<h1><a class="anchor" id="traversal_functions"></a>
Traversal Solution</h1>
<p>The Exchange Toolkit provides just three functions for easily traversing the entirety of the Exchange data model. They are:</p>
<ol type="1">
<li><p class="startli"><a class="el" href="group__traversal.html#gaf65a30c9e905e2987bf29fd96296cc6c" title="Returns an array of instance paths, each with a leaf entity type corresponding to leaf_type...">ts3d::getLeafInstances( A3DEntity *owner, A3DEEntityType const &amp;leaf_type )</a></p>
<p class="startli">This function is used to obtain instance paths from the <code>owner</code> to all child objects of the type specified by <code>leaf_type</code>. The result is a <a class="el" href="group__traversal.html#ga6c2fc4ed635f4edf48fd9e75bdb06263" title="Used as a collection of InstancePath objects. When you ask for all leaf nodes of a particular leaf no...">ts3d::InstancePathArray</a> containing unique paths. The leaf entity object may appear multiple times via differing paths.</p>
<p class="startli">As an example of how this can be used, imagine you'd like to know the total number of parts in a model file. This would look something like this: </p><div class="fragment"><div class="line"><span class="keyword">auto</span> <span class="keyword">const</span> all_parts = <a class="code" href="group__traversal.html#gaf65a30c9e905e2987bf29fd96296cc6c">ts3d::getLeafInstances</a>( loader.m_psModelFile, kA3DTypeAsmPartDefinition );</div><div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;This file contains &quot;</span> &lt;&lt; all_parts.size() &lt;&lt; <span class="stringliteral">&quot; parts.&quot;</span> &lt;&lt; std::endl;</div></div><!-- fragment --><p> This count would include all instances of shared parts.</p>
<dl class="section note"><dt>Note</dt><dd>The type of the <code>owner</code> object is not important. The traversal algorithm will begin at whatever level of the hierarchy you need.</dd></dl>
</li>
<li><p class="startli"><a class="el" href="group__traversal.html#ga9978df59c99dd85d89eb5cbd9d488ace" title="Returns a set of A3DEntity pointers that are unique leaf entities of type leaf_type of the provided o...">ts3d::getUniqueLeafEntities( A3DEntity *owner, A3DEEntityType const &amp;leaf_type )</a>;</p>
<p class="startli">This function is used to obtain a set of unique child objects of type <code>leaf_type</code>. The result is a <a class="el" href="group__access.html#gae64faaef9322c388f862a125363d4ca0" title="Used to absract an unordered collection of unique Exchange objects. ">ts3d::EntitySet</a> containing all unique leaf entities. This function does not provide any information about <em>how</em> the hierarchy was traversed to arrive at these leaf objects.</p>
<p class="startli">As an example of how this can be used, here is a snippet from the <a class="el" href="examples.html#example_attrib">attrib</a> example. In this code, <code>brep_model</code> is a <a class="el" href="group__traversal.html#ga2550c35e83a8d01e9a0155a084a5166d" title="The InstancePath type is used to identify a particular path through the hierarchy of Exchange objects...">ts3d::InstancePath</a> containing a leaf object of type <code>A3DRiBrepModel</code>. </p><div class="fragment"><div class="line">            <span class="keyword">auto</span> <span class="keyword">const</span> faces = <a class="code" href="group__traversal.html#ga9978df59c99dd85d89eb5cbd9d488ace">ts3d::getUniqueLeafEntities</a>( brep_model.back(), kA3DTypeTopoFace );</div><div class="line">            <span class="keywordflow">for</span>( <span class="keyword">auto</span> <span class="keyword">const</span> face : faces ) {</div><div class="line">                <span class="comment">// add face attributes</span></div><div class="line">                ts3d::attachFaceAttributes( face, scale );</div><div class="line">            }</div></div><!-- fragment --><p> Internally, the B-Rep model is traversed and all A3DTopoFace objects are gathered and returned in an unordered set.</p>
</li>
<li><p class="startli"><a class="el" href="group__traversal.html#ga9c75546dcbfd6fa6a84cbae34c0a3a1c" title="Returns a set of A3DEntity pointers that are unique leaf entities and all the instance paths referenc...">ts3d::getUniqueLeafEntities( A3DEntity *owner, A3DEEntityType const &amp;leaf_type, InstancePathMap &amp;instance_path_map )</a></p>
<p class="startli">This overloaded variation can be used when you need a collection of unique child objects of a particular type <em>and</em> you want the instance paths for each occurrence. The final parameter <code>instance_path_map</code> is used with each entity from the returned set as key values. The lookup returns an array of instance paths indicating the unique occurrences of the child object. The following code snippet from the <a class="el" href="examples.html#example_bom">bom</a> example shows how to easily print a bill of materials. </p><div class="fragment"><div class="line">    </div><div class="line">    <span class="comment">// An instance path map will be used to count the number of part occurrences</span></div><div class="line">    <a class="code" href="group__traversal.html#ga3ed69e7c86088be4aad8deaa8fa94cef">ts3d::InstancePathMap</a> instance_paths;</div><div class="line"></div><div class="line">    <span class="comment">// Obtain a set of unique part definition children</span></div><div class="line">    <span class="keyword">auto</span> <span class="keyword">const</span> part_definitions = <a class="code" href="group__traversal.html#ga9978df59c99dd85d89eb5cbd9d488ace">ts3d::getUniqueLeafEntities</a>( loader.m_psModelFile, kA3DTypeAsmPartDefinition, instance_paths );</div><div class="line"></div><div class="line">    <span class="comment">// Iterator over each unique part</span></div><div class="line">    <span class="keywordflow">for</span>( <span class="keyword">auto</span> part_definition : part_definitions ) {</div><div class="line">        <span class="comment">// Get the part&#39;s name or owner&#39;s name if empty</span></div><div class="line">        <a class="code" href="classts3d_1_1_instance.html">ts3d::Instance</a> <span class="keyword">const</span> part_instance( { part_definition } );</div><div class="line">        <span class="keyword">auto</span> <span class="keyword">const</span> part_name = part_instance.<a class="code" href="classts3d_1_1_instance.html#ad510254ee846664c4e9d39af70eef430">getName</a>().empty() ? <span class="stringliteral">&quot;&lt;unknown&gt;&quot;</span> : part_instance.getName();</div><div class="line"></div><div class="line">        <span class="comment">// Print the part name and number of occurrences</span></div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;\&quot;&quot;</span> &lt;&lt; part_name &lt;&lt; <span class="stringliteral">&quot;\&quot;: &quot;</span></div><div class="line">                  &lt;&lt; <span class="stringliteral">&quot;(&quot;</span> &lt;&lt; instance_paths[part_definition].size() </div><div class="line">                  &lt;&lt; <span class="stringliteral">&quot; instance&quot;</span> </div><div class="line">                  &lt;&lt; (1 != instance_paths[part_definition].size() ? <span class="stringliteral">&quot;s)&quot;</span> : <span class="stringliteral">&quot;)&quot;</span>) </div><div class="line">                  &lt;&lt; std::endl;</div><div class="line">    }</div></div><!-- fragment --><p> Using <code>samples/data/catiaV5/CV5_Micro_Engine/_micro engine.CATProduct</code> as input, this code writes the following lines to standard out: </p><div class="fragment"><div class="line"><span class="stringliteral">&quot;SCREW TOP&quot;</span>: (4 instances)</div><div class="line"><span class="stringliteral">&quot;CARBURETOR&quot;</span>: (1 instance)</div><div class="line"><span class="stringliteral">&quot;SCREW BACK&quot;</span>: (4 instances)</div><div class="line"><span class="stringliteral">&quot;HOUSING BACK&quot;</span>: (1 instance)</div><div class="line"><span class="stringliteral">&quot;BEARING PR UP&quot;</span>: (1 instance)</div><div class="line"><span class="stringliteral">&quot;PUSH ROD&quot;</span>: (1 instance)</div><div class="line"><span class="stringliteral">&quot;AXE&quot;</span>: (1 instance)</div><div class="line"><span class="stringliteral">&quot;BEARING PR DW&quot;</span>: (1 instance)</div><div class="line"><span class="stringliteral">&quot;CRANKSHAFT&quot;</span>: (1 instance)</div><div class="line"><span class="stringliteral">&quot;PISTON&quot;</span>: (1 instance)</div><div class="line"><span class="stringliteral">&quot;CYLINDER LINER&quot;</span>: (1 instance)</div><div class="line"><span class="stringliteral">&quot;HOUSING TOP&quot;</span>: (1 instance)</div><div class="line"><span class="stringliteral">&quot;HOUSING&quot;</span>: (1 instance)</div><div class="line"><span class="stringliteral">&quot;HOUSING FRONT&quot;</span>: (1 instance)</div><div class="line"><span class="stringliteral">&quot;BEARING CS&quot;</span>: (1 instance)</div></div><!-- fragment --> </li>
</ol>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
